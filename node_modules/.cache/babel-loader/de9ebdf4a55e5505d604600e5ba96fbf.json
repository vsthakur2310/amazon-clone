{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\V.S. Thakur\\\\Documents\\\\pro\\\\amazon-clone\\\\amazon-clone\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\V.S. Thakur\\\\Documents\\\\pro\\\\amazon-clone\\\\amazon-clone\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:\\\\Users\\\\V.S. Thakur\\\\Documents\\\\pro\\\\amazon-clone\\\\amazon-clone\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{Link,useHistory}from\"react-router-dom\";import React,{useEffect,useState}from\"react\";import CheckoutProduct from\"./CheckoutProduct\";import\"./Payment.css\";import{useStateValue}from\"./StateProvider\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import CurrencyFormat from\"react-currency-format\";import{getCartTotal}from\"./reducer\";import axios from\"axios\";function Payment(){var _useStateValue=useStateValue(),_useStateValue2=_slicedToArray(_useStateValue,2),_useStateValue2$=_useStateValue2[0],cart=_useStateValue2$.cart,user=_useStateValue2$.user,dispatch=_useStateValue2[1];var history=useHistory();var stripe=useStripe();var elements=useElements();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),succeeded=_useState2[0],setSucceeded=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),error=_useState6[0],setError=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),disabled=_useState8[0],setDisabled=_useState8[1];var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),clientSecret=_useState10[0],setClientSecret=_useState10[1];useEffect(function(){var getClientSecret=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios({method:\"post\",// Stripe expects the total in a currencies subunits\nurl:\"/payments/create?total=\".concat(getCartTotal(cart)*100)});case 2:response=_context.sent;setClientSecret(response.data.clientSecret);case 4:case\"end\":return _context.stop();}}},_callee);}));return function getClientSecret(){return _ref.apply(this,arguments);};}();getClientSecret();},[cart]);console.log(\"THE SECRET IS >>>\",clientSecret);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var payload;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0://fancy stripe stuff\nevent.preventDefault();setProcessing(true);_context2.next=4;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:elements.getElement(CardElement)}}).then(function(_ref3){var paymentIntent=_ref3.paymentIntent;// paymentIntent = payment confirmation\nsetSucceeded(true);setError(null);setProcessing(false);history.replace(\"/orders\");});case 4:payload=_context2.sent;case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(event){// Listen for change in the cardelement\n//   and display any errors as the customer types their card details\nsetDisabled(event.empty);setError(event.error?event.error.message:\"\");};return/*#__PURE__*/React.createElement(\"div\",{className:\"payment\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment_container\"},/*#__PURE__*/React.createElement(\"h1\",null,\"Checkout (\",/*#__PURE__*/React.createElement(Link,{to:\"/checkout\"},\" \",cart===null||cart===void 0?void 0:cart.length,\" items \"),\")\"),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment_title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Delivery Address\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_address\"},/*#__PURE__*/React.createElement(\"p\",null,user===null||user===void 0?void 0:user.email),/*#__PURE__*/React.createElement(\"p\",null,\"1332B/8 Kalkaji\"),/*#__PURE__*/React.createElement(\"p\",null,\"New Delhi 110019\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment_title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Review items and delivery\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_items\"},cart.map(function(item){return/*#__PURE__*/React.createElement(CheckoutProduct,{id:item.id,title:item.title,image:item.image,price:item.price,rating:item.rating});}))),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_section\"},/*#__PURE__*/React.createElement(\"div\",{className:\"payment_title\"},/*#__PURE__*/React.createElement(\"h3\",null,\"Payment Method\")),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_details\"},/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(CardElement,{onChange:handleChange}),/*#__PURE__*/React.createElement(\"div\",{className:\"payment_priceContainer\"},/*#__PURE__*/React.createElement(CurrencyFormat,{renderText:function renderText(value){return/*#__PURE__*/React.createElement(\"h3\",null,\"Order Total: \",value,\" \");},decimalScale:2,value:getCartTotal(cart),displayType:\"text\",thousandSeparator:true,prefix:\" ₹\"}),/*#__PURE__*/React.createElement(\"button\",{disabled:processing||disabled||succeeded},/*#__PURE__*/React.createElement(\"span\",null,processing?/*#__PURE__*/React.createElement(\"p\",null,\"Processing\"):\"Buy Now\"))),error&&/*#__PURE__*/React.createElement(\"div\",null,error))))));}export default Payment;","map":{"version":3,"sources":["C:/Users/V.S. Thakur/Documents/pro/amazon-clone/amazon-clone/src/Payment.js"],"names":["Link","useHistory","React","useEffect","useState","CheckoutProduct","useStateValue","CardElement","useElements","useStripe","CurrencyFormat","getCartTotal","axios","Payment","cart","user","dispatch","history","stripe","elements","succeeded","setSucceeded","processing","setProcessing","error","setError","disabled","setDisabled","clientSecret","setClientSecret","getClientSecret","method","url","response","data","console","log","handleSubmit","event","preventDefault","confirmCardPayment","payment_method","card","getElement","then","paymentIntent","replace","payload","handleChange","empty","message","length","email","map","item","id","title","image","price","rating","value"],"mappings":"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","sourcesContent":["import { Link, useHistory } from \"react-router-dom\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport CheckoutProduct from \"./CheckoutProduct\";\r\nimport \"./Payment.css\";\r\nimport { useStateValue } from \"./StateProvider\";\r\nimport { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\r\nimport CurrencyFormat from \"react-currency-format\";\r\nimport { getCartTotal } from \"./reducer\";\r\nimport axios from \"axios\";\r\n\r\nfunction Payment() {\r\n  const [{ cart, user }, dispatch] = useStateValue();\r\n  const history = useHistory();\r\n\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n\r\n  const [succeeded, setSucceeded] = useState(false);\r\n  const [processing, setProcessing] = useState(\"\");\r\n  const [error, setError] = useState(null);\r\n  const [disabled, setDisabled] = useState(true);\r\n  const [clientSecret, setClientSecret] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const getClientSecret = async () => {\r\n      const response = await axios({\r\n        method: \"post\",\r\n        // Stripe expects the total in a currencies subunits\r\n        url: `/payments/create?total=${getCartTotal(cart) * 100}`,\r\n      });\r\n      setClientSecret(response.data.clientSecret);\r\n    };\r\n    getClientSecret();\r\n  }, [cart]);\r\n\r\n  console.log(\"THE SECRET IS >>>\", clientSecret);\r\n\r\n  const handleSubmit = async (event) => {\r\n    //fancy stripe stuff\r\n    event.preventDefault();\r\n    setProcessing(true);\r\n\r\n    const payload = await stripe\r\n      .confirmCardPayment(clientSecret, {\r\n        payment_method: {\r\n          card: elements.getElement(CardElement),\r\n        },\r\n      })\r\n      .then(({ paymentIntent }) => {\r\n        // paymentIntent = payment confirmation\r\n\r\n        setSucceeded(true);\r\n        setError(null);\r\n        setProcessing(false);\r\n\r\n        history.replace(\"/orders\");\r\n      });\r\n  };\r\n\r\n  const handleChange = (event) => {\r\n    // Listen for change in the cardelement\r\n    //   and display any errors as the customer types their card details\r\n    setDisabled(event.empty);\r\n    setError(event.error ? event.error.message : \"\");\r\n  };\r\n\r\n  return (\r\n    <div className=\"payment\">\r\n      <div className=\"payment_container\">\r\n        <h1>\r\n          Checkout (<Link to=\"/checkout\"> {cart?.length} items </Link>)\r\n        </h1>\r\n\r\n        {/* Payment section - delivery address */}\r\n        <div className=\"payment_section\">\r\n          <div className=\"payment_title\">\r\n            <h3>Delivery Address</h3>\r\n          </div>\r\n          <div className=\"payment_address\">\r\n            <p>{user?.email}</p>\r\n            <p>1332B/8 Kalkaji</p>\r\n            <p>New Delhi 110019</p>\r\n          </div>\r\n        </div>\r\n        {/* Payment section - reviwing items */}\r\n        <div className=\"payment_section\">\r\n          <div className=\"payment_title\">\r\n            <h3>Review items and delivery</h3>\r\n          </div>\r\n          <div className=\"payment_items\">\r\n            {cart.map((item) => (\r\n              <CheckoutProduct\r\n                id={item.id}\r\n                title={item.title}\r\n                image={item.image}\r\n                price={item.price}\r\n                rating={item.rating}\r\n              />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        {/* Payment section - payment method */}\r\n        <div className=\"payment_section\">\r\n          <div className=\"payment_title\">\r\n            <h3>Payment Method</h3>\r\n          </div>\r\n          <div className=\"payment_details\">\r\n            {/* Stripe magic will go */}\r\n            <form onSubmit={handleSubmit}>\r\n              <CardElement onChange={handleChange} />\r\n\r\n              <div className=\"payment_priceContainer\">\r\n                <CurrencyFormat\r\n                  renderText={(value) => <h3>Order Total: {value} </h3>}\r\n                  decimalScale={2}\r\n                  value={getCartTotal(cart)}\r\n                  displayType={\"text\"}\r\n                  thousandSeparator={true}\r\n                  prefix={\" ₹\"}\r\n                />\r\n                <button disabled={processing || disabled || succeeded}>\r\n                  <span>{processing ? <p>Processing</p> : \"Buy Now\"}</span>\r\n                </button>\r\n              </div>\r\n              {/* Error */}\r\n              {error && <div>{error}</div>}\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Payment;\r\n"]},"metadata":{},"sourceType":"module"}